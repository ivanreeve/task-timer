<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Todo App</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap');

    :root {
      --color-timerbtn: #40a02b;
      --color-editbtn: #1e66f5;
      --color-editbtn-hover: #0d47a1;
      --color-deletebtn: #f44336;
      --color-deletebtn-hover: #da190b;
    }

    *,
    *::before,
    *::after {
      margin: 0px;
      padding: 0px;
    }

    body {
      font-family: Nunito;
      font-weight: 700;
      height: 100vh;
      width: 100vw;
      margin: 0 auto;
      background-color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .header {
      position: sticky;
      padding-top: 20px;
      padding-bottom: 10px;
      top: 0;
      background-color: white;
      z-index: 1000;
    }

    .container {
      background-color: white;
      padding: 0 20px 20px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      width: 800px;
      overflow-y: auto;
      max-height: 80vh;
    }

    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 20px;
      text-transform: uppercase;
    }

    .input-section {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    #todoInput {
      flex-grow: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }

    button {
      padding: 8px 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }

    button:hover {
      background-color: #45a049;
    }

    .todo-item {
      display: flex;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #eee;
      gap: 10px;
      transition: background-color 0.3s ease;
    }

    .todo-item:last-child {
      border-bottom: none;
    }

    .todo-text {
      flex-grow: 1;
    }

    .completed {
      text-decoration: line-through;
      color: #888;
    }

    .edit-btn {
      background-color: var(--color-editbtn);
    }

    .edit-btn:hover {
      background-color: var(--color-editbtn-hover);
    }

    .delete-btn {
      background-color: var(--color-deletebtn);
    }

    .delete-btn:hover {
      background-color: var(--color-deletebtn-hover);
    }

    .timer-btn {
      background-color: var(--color-timerbtn);
    }

    .timer-btn:hover {
      background-color: #358a22;
    }

    .timer-btn.active {
      background-color: #d20f39;
    }

    .timer-btn.active:hover {
      background-color: #b30d31;
    }

    .timer-container {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .timer-input {
      width: 60px;
      padding: 4px;
      margin-right: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .timer-display {
      min-width: 80px;
      text-align: center;
      font-family: monospace;
      font-size: 14px;
    }

    .time-up {
      background-color: #ffebee;
      animation: flash 1s infinite;
    }

    @keyframes flash {
      0% {
        background-color: #ffebee;
      }

      50% {
        background-color: #ffcdd2;
      }

      100% {
        background-color: #ffebee;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>Todo App</h1>
      <div class="input-section">
        <input type="text" id="todoInput" placeholder="Add a new todo...">
        <button onclick="addTodo()">Add</button>
      </div>
    </div>
    <div id="todoList"></div>
  </div>

  <audio id="timerSound" preload="auto">
    <source
      src="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAADAAAGhgBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr///////////////////////////////////////////8AAAA5TEFNRTMuOTlyAc0AAAAAAAAAABSAJAOkQgAAgAAABoYWxzM3AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADwAABpAAAACAAADSAAAAETEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU="
      type="audio/mpeg">
  </audio>

  <script>
    let todos = JSON.parse(localStorage.getItem('todos')) || [];
    let timers = {};

    renderTodos();

    function addTodo() {
      const input = document.getElementById('todoInput');
      const todoText = input.value.trim();

      if (todoText) {
        const todo = {
          id: Date.now(),
          text: todoText,
          completed: false,
          elapsedTime: 0,
          targetTime: 0,
          timeUp: false
        };

        todos.push(todo);
        saveTodos();
        renderTodos();
        input.value = '';
      }
    }

    function toggleTodo(id) {
      todos = todos.map(todo => {
        if (todo.id === id) {
          return {...todo, completed: !todo.completed};
        }
        return todo;
      });

      saveTodos();
      renderTodos();
    }

    function deleteTodo(id) {
      stopTimer(id);
      todos = todos.filter(todo => todo.id !== id);
      saveTodos();
      renderTodos();
    }

    function showEditDialogue(id) {
      const todo = todos.find(todo => todo.id === id);
      const todoText = prompt('Edit todo', todo.text);

      if (todoText) {
        todos = todos.map(todo => {
          if (todo.id === id) {
            return {...todo, text: todoText};
          }
          return todo;
        });

        saveTodos();
        renderTodos();
      }
    }

    function setTargetTime(id, minutes) {
      todos = todos.map(todo => {
        if (todo.id === id) {
          return {...todo, targetTime: minutes * 60 * 1000, timeUp: false};
        }
        return todo;
      });
      saveTodos();
    }

    function toggleTimer(id) {
      const timerBtn = document.querySelector(`[data-timer-id="${id}"]`);
      const timerDisplay = document.querySelector(`[data-display-id="${id}"]`);

      if (timers[id]) {
        stopTimer(id);
        timerBtn.textContent = 'Start Timer';
        timerBtn.classList.remove('active');
      } else {
        startTimer(id, timerDisplay);
        timerBtn.textContent = 'Stop Timer';
        timerBtn.classList.add('active');
      }
    }

    function startTimer(id, display) {
      const todo = todos.find(todo => todo.id === id);
      let startTime = Date.now() - (todo.elapsedTime || 0);

      timers[id] = setInterval(() => {
        const elapsedTime = Date.now() - startTime;
        display.textContent = formatTime(elapsedTime);

        // Check if target time is reached
        if (todo.targetTime > 0 && elapsedTime >= todo.targetTime && !todo.timeUp) {
          const todoItem = document.querySelector(`[data-id="${id}"]`);
          todoItem.classList.add('time-up');

          // Play sound
          const audio = document.getElementById('timerSound');
          audio.play();

          // Show alert
          alert(`Time's up for task: ${todo.text}`);

          // Mark as time up
          todos = todos.map(t => {
            if (t.id === id) {
              return {...t, timeUp: true};
            }
            return t;
          });
          saveTodos();
        }

        // Update the todo's elapsed time
        todos = todos.map(t => {
          if (t.id === id) {
            return {...t, elapsedTime};
          }
          return t;
        });
        saveTodos();
      }, 1000);
    }

    function stopTimer(id) {
      if (timers[id]) {
        clearInterval(timers[id]);
        delete timers[id];
      }
    }

    function formatTime(ms) {
      const seconds = Math.floor(ms / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      return `${pad(hours)}:${pad(minutes % 60)}:${pad(seconds % 60)}`;
    }

    function pad(number) {
      return number.toString().padStart(2, '0');
    }

    function saveTodos() {
      localStorage.setItem('todos', JSON.stringify(todos));
    }

    function renderTodos() {
      const todoList = document.getElementById('todoList');
      todoList.innerHTML = '';

      todos.forEach(todo => {
        const todoItem = document.createElement('div');
        todoItem.className = `todo-item ${todo.timeUp ? 'time-up' : ''}`;
        todoItem.dataset.id = todo.id;

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = todo.completed;
        checkbox.onclick = () => toggleTodo(todo.id);

        const todoText = document.createElement('span');
        todoText.className = `todo-text ${todo.completed ? 'completed' : ''}`;
        todoText.textContent = todo.text;

        const timerContainer = document.createElement('div');
        timerContainer.className = 'timer-container';

        const timeInput = document.createElement('input');
        timeInput.type = 'number';
        timeInput.className = 'timer-input';
        timeInput.placeholder = 'Min';
        timeInput.min = 1;
        timeInput.value = todo.targetTime ? todo.targetTime / (60 * 1000) : '';
        timeInput.onchange = (e) => setTargetTime(todo.id, e.target.value);

        const timerDisplay = document.createElement('span');
        timerDisplay.className = 'timer-display';
        timerDisplay.dataset.displayId = todo.id;
        timerDisplay.textContent = formatTime(todo.elapsedTime || 0);

        const timerBtn = document.createElement('button');
        timerBtn.className = `timer-btn ${timers[todo.id] ? 'active' : ''}`;
        timerBtn.textContent = timers[todo.id] ? 'Stop Timer' : 'Start Timer';
        timerBtn.dataset.timerId = todo.id;
        timerBtn.onclick = () => toggleTimer(todo.id);

        timerContainer.appendChild(timeInput);
        timerContainer.appendChild(timerDisplay);
        timerContainer.appendChild(timerBtn);

        const editBtn = document.createElement('button');
        editBtn.className = 'edit-btn';
        editBtn.textContent = 'Edit';
        editBtn.onclick = () => showEditDialogue(todo.id);

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = 'Delete';
        deleteBtn.onclick = () => deleteTodo(todo.id);

        todoItem.appendChild(checkbox);
        todoItem.appendChild(todoText);
        todoItem.appendChild(timerContainer);
        todoItem.appendChild(editBtn);
        todoItem.appendChild(deleteBtn);
        todoList.appendChild(todoItem);
      });
    }

    document.getElementById('todoInput').addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        addTodo();
      }
    });
  </script>
</body>

</html>
